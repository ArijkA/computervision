<!DOCTYPE html>
<html dir="ltr" lang="ru">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="stylesheet.css">
	<link rel="stylesheet" type="text/css" href="pagespeed.css">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<script type="text/javascript" src='http://codepen.io/assets/libs/fullpage/jquery.js'></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</head>
<body>
<div id="container-100" style="height: 100%;">
	<div id="container">
		<div id="content">

			<div class="category-details">
				<div class="category-details-top">
					<div class="category-h1 input-group" style="margin-top: 20px; margin-left: 20px; width: 103%;">
						<div class="input-group">
							<span class="input-group-addon" id="basic-addon3">Category ID:</span>
							<input id="selected-category-name" class="form-control" placeholder="Input category id"/>
						</div>
					<span class="input-group-btn">
    	    			<button type="button" class="btn btn-primary" onclick="checkInputAndShowCategoryProducts($('#selected-category-name').val())">Show</button>
      				</span>
					</div>
				</div>
			</div>
			<div>
				<div class="product-list"/>
			</div>
		</div>
	</div>
</div>
<div id="spinner" class="spinner" style="display:none;">
	<img id="img-spinner" src="spinner.gif" alt="Loading"/>
</div>
</body>
<script type="text/javascript">
	var categoryNameIdMap = {
		"5449" : "Dresses",
		"20640" : "Polo",
		"255" : "Top",
		"13247" : "Shoes",
		"16908" : "LUGGAGE",
		"24479" : "LUGGAGE",
		"46971" : "LUGGAGE",
		"29722" : "LUGGAGE",
		"25691" : "LUGGAGE",
		"62074" : "LUGGAGE",
		"71198" : "LUGGAGE",
		"20688" : "LUGGAGE",
		"28602" : "LUGGAGE",
		"28617" : "LUGGAGE"
	};
	var categoriesMap = {};
	function reverse(s) {
		var o = [];
		for (var i = 0, len = s.length; i <= len; i++)
			o.push(s.charAt(len - i));
		return o.join('');
	}


	/*$.getJSON("/dataCollectionJonOutput/result.json", function(resultJson) {
	 alert('success');
	 if (resultJson && resultJson.categories) {
	 $(resultJson.categories).each(function(index, value) {
	 categoriesMap[parseInt(value.categoryId, 10)] = value;
	 });
	 }
	 });*/

	$('#selected-category-name').keypress(function(event){
		var keycode = (event.keyCode ? event.keyCode : event.which);
		if(keycode == '13'){
			checkInputAndShowCategoryProducts($('#selected-category-name').val());
		}
	});

	$(document).ready(function(){
		$(".dropdown").on("show.bs.dropdown", function(event){
			var x = $(event.relatedTarget).text(); // Get the button text
			alert("You clicked on: " + x);
		});
	});

	function checkInputAndShowCategoryProducts(categoryId) {
			$('#spinner').show();
			$.getJSON('rootFolder/'+categoryId+ '/result.json', function(resultJson) {
				showProductsAndUpcsFromCategory(resultJson);
				$('#spinner').hide();
			});
		/*{
		 success: function(resultJson) {
		 showProductsAndUpcsFromCategory(resultJson);
		 },
		 error: function() {
		 alert('Wrong category id');
		 }
		 }
		 );*/
		/*var category = categoriesMap[categoryId];
		 if (category != undefined || category == NaN) {
		 $('.product').remove();
		 showProductsAndUpcsFromCategory(category);
		 } else {
		 alert('Wrong category id');
		 }*/
	}

	function getImageSrcForComputerVisionRecognition(value) {
		if (value.computerVisionRecognition == 0) {
			return 'lg-success-flat.png';
		}
		if (value.computerVisionRecognition == 1) {
			return 'lg-alertY-flat.png';
		}
		if (value.computerVisionRecognition == 2) {
			return 'lg-alertO-flat.png';
		}
		if (value.computerVisionRecognition == 3) {
			return 'lg-failed-flat.png';
		}
	}

	function getImageTitleForComputerVisionRecognition(value) {
		if (value.computerVisionRecognition == 0) {
			return 'COLOR_NORMAL is equal to dominant color';
		}
		if (value.computerVisionRecognition == 1) {
			return ' COLOR_NORMAL is not MULTI and we have no dominant';
		}
		if (value.computerVisionRecognition == 2) {
			return 'COLOR_NORMAL is not dominant in CV_COLORS';
		}
		if (value.computerVisionRecognition == 3) {
			return 'COLOR_NORMAL does not present in CV_COLORS';
		}
	}

	function showProductsAndUpcsFromCategory(products) {
		$('.product').remove();
		$(products).each(function(index, product) {
			var productDiv = '<div class="product-list product"><a href="https://stars.macys.com/stella-core/#legacyUI/%2FUI%2Fstella%2Fwebproduct%2Fview.html%3Fid%3D'+product.productID+'%26subtemplate%3DWebProductDisplayOverview%23product%2Fview%2F'+product.productID+'"><h3 style="margin-left: 20px;">Product '+product.productID+'</h3></a><p style="margin-left: 20px;">Description: '+product.productDescription+'</p></div>';
			$('.product-list').first().append(productDiv);
			$(product.upcSet).each(function(index, value) {
				var upcDiv = '<div>';
				upcDiv += '<div class="right">';
				upcDiv += '<div style="text-align: center;">';
				upcDiv += '<div class="state">';
				upcDiv += '<b>Color check:</b><br/>'
				upcDiv += '<img src="'+getImageSrcForComputerVisionRecognition(value)+'" style="margin: 40px 0px 20px 8px;" title="'+getImageTitleForComputerVisionRecognition(value)+'"></img>';
				upcDiv += '</div>';
				upcDiv += '</div>';
				upcDiv += '</div>';
				upcDiv += '<div class="left">';
				var linkToImage = '/';

				var imageIdInt = parseInt(value.imageId, 10);
				for (var i=1; i<9; i++) {

					linkToImage += parseInt((imageIdInt % parseInt(Math.pow(10,i), 10) / parseInt(Math.pow(10,i-1), 10)), 10);
					if ((i % 2) == 0){
						linkToImage += '/';
					}
				}

				linkToImage = 'https://stars.macys.com/preview'+reverse(linkToImage) + 'final/'+imageIdInt+'-214x261.jpg';

				upcDiv += '<div class="image"><a><img src="'+ linkToImage +'"></a></div>';
				upcDiv += '<div class="name"><b>UPC_ID: </b>'+value.upcId+'</div>';
				upcDiv += '<div class="description" style="white-space: pre; height: 100%;">'
						+value.description
						+'\n<b>colrNormalId:</b> '+value.colrNormalId
						+'\n<b>colorNormal:</b> '+value.colorNormal
						+'\n<b>displayColorName:</b> '+value.displayColorName
						+'\n<b>computerVisionResult:</b> ';
				$.each(value.computerVisionResult, function(key, value) {
					upcDiv += '\n\t<b>'+value+':</b> '+key + '%';
				});
				upcDiv +='</div>';
				upcDiv += '</div>';
				$('.product-list').last().append(upcDiv);
			});
		});


		/*$(category.products).each(function(index, product) {
		 var productDiv = '<div class="product-list product"><a href="https://stars.macys.com/stella-core/#legacyUI/%2FUI%2Fstella%2Fwebproduct%2Fview.html%3Fid%3D'+product.productID+'%26subtemplate%3DWebProductDisplayOverview%23product%2Fview%2F'+product.ProductID+'"><h3 style="margin-left: 20px;">Product '+product.productID+'</h3></a><p style="margin-left: 20px;">Description: '+product.productDescription+'</p></div>';
		 $('.product-list').append(productDiv);
		 $(product.upcSet).each(function(index, value) {
		 var upcDiv = '<div>';
		 upcDiv += '<div class="right">';
		 upcDiv += '<div style="text-align: center;">';
		 upcDiv += '<div class="state">';
		 upcDiv += '<b>Color check:</b><br/>'
		 upcDiv += '<img src="'+getImageSrcForComputerVisionRecognition(value)+'" style="margin: 40px 0px 20px 8px;"></img>';
		 upcDiv += '</div>';
		 upcDiv += '</div>';
		 upcDiv += '</div>';
		 upcDiv += '<div class="left">';
		 var linkToImage = '/';

		 var imageIdInt = parseInt(value.imageId, 10);
		 for (var i=1; i<9; i++) {

		 linkToImage += parseInt((imageIdInt % parseInt(Math.pow(10,i), 10) / parseInt(Math.pow(10,i-1), 10)), 10);
		 if ((i % 2) == 0){
		 linkToImage += '/';
		 }
		 }

		 linkToImage = 'https://stars.macys.com/preview'+reverse(linkToImage) + 'final/'+imageIdInt+'-214x261.jpg';

		 upcDiv += '<div class="image"><a><img src="'+ linkToImage +'"></a></div>';
		 upcDiv += '<div class="name"><b>UPC_ID: </b>'+value.upcId+'</div>';
		 upcDiv += '<div class="description" style="white-space: pre; height: 100%;">'
		 +value.description
		 +'\n<b>colrNormalId:</b> '+value.colrNormalId
		 +'\n<b>colorNormal:</b> '+value.colorNormal
		 +'\n<b>displayColorName:</b> '+value.displayColorName
		 +'\n<b>computerVisionResult:</b> ';
		 $.each(value.computerVisionResult, function(key, value) {
		 upcDiv += '\n\t<b style="color: '+(key != 'white' ? key : 'black')+'">'+key+':</b> '+value + '%';
		 });
		 upcDiv +='</div>';
		 upcDiv += '</div>';
		 $('.product-list').last().append(upcDiv);
		 });
		 });	*/
	}
</script>
</html>